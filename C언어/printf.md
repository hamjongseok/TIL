# **🌈Printf🌈**

## **printf함수**

---

- 이번 프로젝트는 stdio.h 기본 라이브러리에 포함되어 있는 printf 함수의 일부 기능들을 직접 구현하는 것이다.
- printf의 f는 formatted의 약자이며, 서식화된 출력을 지원한다는 의미이다.
- printf의 기능은 많지만 난 일반만 하기로 생각했기때문에
  서식지정자와 출력만 구현하면되었다.
- 앞선 gnl 과제보다는 무엇을 하면 될지 명확하게 알아서 처음은 수월하게
  할수 있었다.

```c
int ft_printf(const char *, ...);
```

- 리턴값 : 출력한 문자의 개수, 에러시 음수 반환 (-1)

## 가변 인자

- C 언어에서 함수를 사용하다 보면 printf, scanf같이 매개변수의 개수가 정해지지 않은 함수가 있다.
- 위의 프로토타입의 매개변수에 보이는 ... 이것이 가변 인자이다.
- 매번 함수에 들어가는 인수(argument)의 개수가
  변하는 것을 가변 인자(가변 인수, variable argument)라고 한다.

```c
 ex) printf("str: %s, %s",msg,dsd);

     printf("%s,%s,%d,%p",a,b,c,d);
```

- 함수에서 가변 인자를 정의할 때는 고정 매개변수가 한 개 이상 있어야 하며
  고정 매개변수 뒤에 ...을 붙여 매개변수의 개수가 정해지지 않았다는 표시를 해준다.
- 단, ... 뒤에는 다른 매개변수를 지정할 수 없다.

- 여기서 궁금한점

```c
가변인자의 개수가 서식지정자 보다 많을경우는 ?

printf("%d\n",1,'a'); => 정수 1만 출력이 된다.
 => 그이유는 *fmt가 널일때까지 while을 돌려서 출력하는것이기때문

반대로 가변인자의 개수보다 서식지정자의 개수가 더많을 경우는 ?
 printf("%d %s\n",1); => 1, (null)반환

 d, x일경우에는 0반환
 p 경우 0x0

```

---

## 가변 인자 함수

- 가변인자를 사용하려면 가변인자 함수를 이용해야한다.
- 가변인자 함수
  - va_list
  - va_start
  - va_copy
  - va_arg
  - va_end
- 필요한 헤더 <stdarg.h>

---

## 1. va \_list

- 함수로 전달되는 인수들은 스택이라는 기억저장소에 저장되며 함수는 스택에서 인자수를 꺼내쓴다.
- 스택에 있는 인수를 읽을때 포인터 연산을 해야하는데 현재 읽고있는 번지를 기억하기위해 va_list형의 포인터 변수 하나가 필요하다.
- 길이가 변할수 있는 인수들을 저장하려면 가변의 저장공간이 필요하다.
- va_list라는 타입이 가변공간이 되는것이다.
- 관습적으로 ap라는 이름을 사용한다고 한다.

---

## 2. va_start

```c
va_start(ap, 고정인수)
```

- va_start는 위에서 선언한 va_list 타입의 ap를 초기화 해주는 매크로이다.
- va_start를 통해 첫 번째 가변 인자의 주소를 ap가 참조할 수 있도록 만들어준다.
- 실제 코드를 보면 va_list 주소값에다가 고정인수 크기를 더한 위치로 ap를 초기화한다.
- 초기화하는이유는 ap는 가변함수에 들어오는 고정인수 다음부터 위치되어야하기때문

```c
#define va_start(ap, v)
 ( (ap) = (va_list)_ADDRESSOF(v) + _INTSIZEOF(v) )

va_start(ap, *fmt)
=> fmt 다음 가변인자 첫 주소를 가리키게한다.

```

- 가변인수를 가져올수있도록 포인터를 설정한다.

![](https://dojang.io/pluginfile.php/641/mod_page/content/30/unit66-1.png)

- 출처 코딩도장

---

## 3. va_arg
