# **🦑 So_long 🦑**

## **기본 개념**

---

- 출발점에서 시작해서 아이템을 먹고 도착점까지 가는 게임 만들기
- 캐릭터가 움직일 때마다 움직인 횟수가 쉘에 기록되어야 한다
- W A S D로 캐릭터 이동
- ESC 누르면 창이 닫히고 프로그램 종료
- 윈도우의 빨간 창닫기 버튼 누르면 창이 닫히고 프로그램 종료
- 인자로 .ber 확장자의 맵을 받는 프로그램

---

- Minilibx란?
  - MiniLibX는 X-Window 및 Cocoa에 대한 지식 없이도 화면에서 무언가를 그리기위한 기본적인 그래픽 라이브러리이다.
  - 간단한 창 생성, 그리기 도구, 이미지 기능 및 이벤트 관리 시스템을 제공한다.

## Mlx 초기화하기

```c
#include <mlx.h>

int main(void)
{
	void *mlx_ptr;

	mlx_ptr = mlx_init();
	return (0);
}

mlx_ptr은 mlx_init()함수가 리턴하는 주소를 가리키게 된다.

mlx_init()함수는 디스플레이와 우리의 프로그램을 연결시켜주는 초기화 함수이다.
```

## window창 생성하기

```c
win_ptr = mlx_new_window(mlx_ptr, 500, 500, "Hellow World!");

mlx_ptr : mlx_init이 반환한 연결 식별자
size_x : 창의 가로 사이즈
size_y : 창의 세로 사이즈
title : 타이틀 바에 표시될 문자열

```

- 초기화 하지 않은 mlx_ptr이 mlx_new_window함수로 전달된다면 segfault를 발생한다.
- 함수는 창을 생성하는 것 까지만 작동하고 실제로 모니터상에 창을 띄우진 않는다. mlx_loop 함수가 실제로 모니터상에 창을 띄우는 역할을 해준다.

```
int mlx_loop(void *mlx_ptr)

mlx_ptr :  디스플레이에 연결되어 있는 mlx_ptr
return value : no return
```

---

## MAKEFILE

- 리턴값 : 출력한 문자의 개수, 에러시 음수 반환 (-1)

## 가변 인자

- C 언어에서 함수를 사용하다 보면 printf, scanf같이 매개변수의 개수가 정해지지 않은 함수가 있다.
- 위의 프로토타입의 매개변수에 보이는 ... 이것이 가변 인자이다.
- 매번 함수에 들어가는 인수(argument)의 개수가
  변하는 것을 가변 인자(가변 인수, variable argument)라고 한다.

```c
 ex) printf("str: %s, %s",msg,dsd);

     printf("%s,%s,%d,%p",a,b,c,d);
```

- 함수에서 가변 인자를 정의할 때는 고정 매개변수가 한 개 이상 있어야 하며
  고정 매개변수 뒤에 ...을 붙여 매개변수의 개수가 정해지지 않았다는 표시를 해준다.
- 단, ... 뒤에는 다른 매개변수를 지정할 수 없다.

- 여기서 궁금한점

```c
가변인자의 개수가 서식지정자 보다 많을경우는 ?

printf("%d\n",1,'a'); => 정수 1만 출력이 된다.
 => 그이유는 *fmt가 널일때까지 while을 돌려서 출력하는것이기때문

반대로 가변인자의 개수보다 서식지정자의 개수가 더많을 경우는 ?
 printf("%d %s\n",1); => 1, (null)반환

 d, x일경우에는 0반환
 p 경우 0x0

```

---

## 가변 인자 함수

- 가변인자를 사용하려면 가변인자 함수를 이용해야한다.
- 가변인자 함수
  - va_list
  - va_start
  - va_copy
  - va_arg
  - va_end
- 필요한 헤더 <stdarg.h>

---

## 1. va \_list

- 함수로 전달되는 인수들은 스택이라는 기억저장소에 저장되며 함수는 스택에서 인자수를 꺼내쓴다.
- 스택에 있는 인수를 읽을때 포인터 연산을 해야하는데 현재 읽고있는 번지를 기억하기위해 va_list형의 포인터 변수 하나가 필요하다.
- 길이가 변할수 있는 인수들을 저장하려면 가변의 저장공간이 필요하다.
- va_list라는 타입이 가변공간이 되는것이다.
- 관습적으로 ap라는 이름을 사용한다고 한다.

---

## 2. va_start

```c
va_start(ap, 고정인수)
```

- va_start는 위에서 선언한 va_list 타입의 ap를 초기화 해주는 매크로이다.
- va_start를 통해 첫 번째 가변 인자의 주소를 ap가 참조할 수 있도록 만들어준다.
- 실제 코드를 보면 va_list 주소값에다가 고정인수 크기를 더한 위치로 ap를 초기화한다.
- 초기화하는이유는 ap는 가변함수에 들어오는 고정인수 다음부터 위치되어야하기때문

```c
#define va_start(ap, v)
 ( (ap) = (va_list)_ADDRESSOF(v) + _INTSIZEOF(v) )

va_start(ap, *fmt)
=> fmt 다음 가변인자 첫 주소를 가리키게한다.

```

- 가변인수를 가져올수있도록 포인터를 설정한다.

![](https://dojang.io/pluginfile.php/641/mod_page/content/30/unit66-1.png)

- 출처 코딩도장

---

## 3. va_arg

- 가변 인수를 실제로 읽는 명령이다.
- ap포인터가 위치한 부분의 데이터를 읽어 반환한다.
  그다음에 ap포인터를 타입길이만큼 뒤로 옮기기 때문에 그다음 값이 이어서 출력될수있다.

```c
단 ap번지에 있는 값이 어떤 타입인지를 지정해야 이매크로가 값을 제대로 읽을수 있으므로
두번째 인수로 읽고자하는 값의 타입을 지정한다.

예를 들어 ap 위치의 있는 정수값을 읽고자한다면 va_arg(ap, int)를 호출하고
실수 값을 읽고자 한다면 va_arg(ap, double)이라고 호출하면된다.
```

- 함수의 인수로는 값이 전달되는것이 정상인데 타입명이 어떻게 함수의 인수가 될수 있을까?
  - va_arg는 함수가 아니라 매크로 함수이기때문에 가능하다
  - va_arg의 두번째 인수는 내부적으로 sizeof 연산자와 캐스트 연산자로 전달되기 때문에
    타입명이 될수 있다.

```c
#define _crt_va_arg(ap,t)    ( *(t *)((ap += _INTSIZEOF(t)) - _INTSIZEOF(t)) )
```

- 더해서 주소값이 증가를 하고(그렇기 때문에 그다음 값이 이어진다) , 그다음 기존위치를 읽는것.
- type의 인수로는 char, float는 사용될 수 없다. int와 double로 대체

---

## 4. va_end

- va_list 를 널 , 0으로 초기화 한다. 다끝났다라는 뜻이다.
- 이함수는 가변인수를 다 읽은 후 뒷정리를 하는데 별다른 동작은 하지않으며
  실제로 없어 아무 지장이없다고 한다.
- 이 명령이 필요한 이유는 호환성때문인데 플랫폼에 따라서는 가변 인수를 읽은 후에 뒷처리를 하는 경우도있기 때문이다. 관례적으로 넣는것이 좋다.
