# **🌎Born2beroot🌎**

## **sudo**

- Super User Do의 줄임말
- UNIX에서는 root계정만이 모든 명령을 실행, 특정한 중요작업을 수행할수있다.
- sudo명령어를 통해 다른 일반 사용자가 일부 명령을 실행하고 시스템 작업을 수행할 수 있도록 허용해준다.

---

```c
sudo 관련 명령어

dpkg -l sudo (설치여부 확인)
apt install sudo (수도설치)
su - (root계정으로 이동)
sudo (명령어)
일반유저가 root권한으로 명령어 실행
su (계정명)
현재 유저를 로그아웃 하지않은 채로 다른 사용자 계정으로 전환
visudo (sudoer파일 접근)

```

---

- 비밀번호 오류는 3번으로 제한됩니다. ⭕️

  - `passwd_tries=3`

- sudo를 사용할 때, 잘못 된 암호로 인한 오류가 발생할 경우 커스텀 메시지를 표시합니다. ⭕️

  - `badpass_message=""`

- sudo를 사용할 때의 모든 입출력 동작은 기록되어야 합니다. 로그 파일은 `/var/log/sudo/` 폴더에 저장됩니다. ⭕️
  - `iolog_dir="/var/log/sudo/"`
- 보안 문제 관련해서, TTY 모드를 활성화합니다.⭕️
  - `requiretty`

```c
  TTY (Teletypewriter)

  콘솔의 한 종류로 Ctrl-Alt-F1 ~ F6 키조합으로 사용할수있는 OS 에서 제공하는 가상콘솔 이다. 실제 물리적인 장치가 연결된것이 아니기 때문에 커널에서 터미널을 emulation 한다. TTY화면간 이동은 ALT+F1~F6이며 GUI환경 복귀는 ALT+F7이다.

출처: https://booolean.tistory.com/666 [Boolean]

콘솔이란 ?
CLI 혹은 CUI라고 불리며 컴퓨터를 운용하기 위한 목적으로 테스트를 사용자와 주고 받는 방식의 인터페이스를 말한다.

```

- 보안 문제 관련해서, sudo에서 사용할 수 있는 경로는 제한됩니다. ⭕️
  - `secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"`

```c
  sudo명령 실행 시 현재 계정의 쉘이 아닌 새로운 쉘을 생성하고 그 안에서 명령을 실행하는데, 이 때 명령을 찾을 경로를 나열한 환경변수인 PATH값이 secure_path

  shell 명령어들은 PATH 환경변수에 지정된 경로에서 바이너리 파일을 찾는다.

 sudo 권한이 있는 사용자의 PATH 환경변수에 악성코드로 인한 경로가 포함되어 있어 특정 명령 실행시 해당 경로에서 악성 파일이 실행될 경우 유저가 sudo를 통해 시스템 전반에 대한 권한을 부여받은 채 해당 명령을 실행한다면 시스템에 큰 문제가 생길 것이다.

이러한 상황을 방지하기 위해 sudo 가 실행되는 가상 쉘에서 명령어의 바이너리 파일 경로를 secure_path 로 제한하는 것이다.
```

## Virtual Box 설치 및 Debian설치

---

- 설치할때 유의 할점

- 데이터 용량 문제때문에 goinfre에다가 설치해야한다.
- goinfre 폴더는 각 아이맥의 로컬저장소라고 알고있다.

- 데비안(Debian)과 센토스(CentOS)

- 데비안(Debian)
  - 데스크탑 및 서버를 비롯한 광범위한 장치를 위한 운영체제이다.
  - 자유소프트웨어(공짜)
  - 많은 배포판의 기반(우분투OS의 기반)
  - 리눅스 커널탑재//커널 = 자동차(OS)로 치면 엔진(커널)
  - 안정성과 보안이 우수하다.
- 센토스(CentOS)
  - RHEL(레드헷 엔터프라이즈 리눅스)에서 파생된 리눅스의 배포판중 하나

```c
리눅스란 ?

쉽게 말하자면, 윈도우와 같은 하나의 독자적인 컴퓨터 운영체제(OS)이다.
(OS란, 컴퓨터의 하드웨어와 소프트웨어를 제어하여, 사용자가 컴퓨터를 쓸 수 있게 만들어주는 프로그램을 말한다.)

리눅스는 공개 소프트웨어라서 그룹이나 회사등에서 커널소스를 받아 OS를 직접제작하여 사용된다.

배포된 리눅스의 종류

데비안 (Debian)
패키지설치 및 업그레이드가 단순하여 간편한 장점이 있음.
안정성과 보안에 중점을 두고 있음

우분투 (ubuntu)
Debian을 기반으로 하여 만들어짐.
windows에 익숙해진 유저들이 리눅스를 쉽게 접할 수 있도록 만들어진 운영체제.

레드 햇 (red hat)
클라우드 인프라구축이 쉽고 간편함.

안드로이드 (android)
구글에서 리눅스를 기반으로 개발한 운영체제로, c, c++, python, java등의 프로그래밍 언어를 지원함.
```

데비안 설치과정

- GUI 설치안함

---

## 선행지식

#### AppArmor & SELinux

- 두개 다 Security framework이며, LSM(Linux Security Module)을 기반으로 구현됨
- 둘다 보안 모델 MAC 적용
- 기존 리눅스는 DAC (임의 접근제어) 적용

```c
MAC (Mandatory Access Control)
강제적 접근 제어 모델
중앙에서 정보를 수집하고 분류하여, 각각의 보안 레벨을 붙이고
이에 대해 정책적으로 접근 제어를 수행한다.

DAC (Discretionary Access Control)
임의적 접근제어 방식은 자원의 소유자 혹은 관리자가 보안관리자의 개입없이 자율적 판단에 따라 접근권한을 다른 사용자에게 부여하는 기법을 말한다
```

- AppArmor
  - Application Armor의 약자
  - 시스템 관리자가 프로그램 프로필 별로 프로그램의 역량을 제한할 수 있게 해주는 리눅스 커널 보안 모듈이다.

```c
커널이란 ?

 하드웨어와 응용 프로그램 사이에서 인터페이스를 제공하여 응용 프로그램이 하드웨어에서부터 오는 자원을 관리하고 사용 할 수 있게 해준다.
 구체적으로 말하면, 커널이란 운영체제(OS)에서 가장 중요한 구성요소로서, 입출력을 관리하고 소프트웨어로부터 요청(System Call)을 컴퓨터에 있는 하드웨어(CPU, 메모리, 저장장치, 모니터)가 처리할 수 있도록 요청(System Call)을 변환하는 역할을 한다.
( User는 Shell을 이용하여 Kernel을 통해 하드웨어를 사용 할 수 있다. )

모듈이란 ?
소프트웨어 설계에서 기능단위로 분해하고 추상화 되어 재사용 및 공유 가능한 수준으로 만들어진 단위

출처 : http://itnovice1.blogspot.com/2019/08/blog-post_83.html
```

- "aa-enabled" 명령어 : 앱아머 활성화 여부 확인 (⭕️)
- 정책 파일을 통해 어떤 어플리케이션이 어떤 파일/경로에 접근하는지 관리
- `enforce모드`와 `complain모드` 두 가지 존재
  - **enforce 모드** : 허가되지 않은 파일에 `접근`하는 것을 `거부`하는 모드
  - **complain 모드** : 실질적으로 보안을 제공하는 것은 아님. 대신 어플리케이션이 해야 할 행동이 아닌 다른 행동을 하는 경우에 앱아머는 `로그`를 남겨준다(중지하지는 않음).
  - `"sudo aa-status"`통해 현재 상태 확인 가능(**enforced**, **complain**, **unconfined**)
- SUSE 계열 (SUSE Linux), 데비안 계열 (Debian, Ubuntu)
- 개별 응용 프로그램을 보호하는 일에 집중
- 응용 프로그램 단위의 보안 모델 구현
- AppArmor는 SELinux를 대체하는 한 부분으로서 제공

---

- SSH 서비스는 4242 포트에서만 실행된다. 보안상의 이유로 SSH를 root로 사용해서 연결하는 것은 금지돤다.
- ssh가 어떻게 작동하는지 알고 있어야 한다.
- UFW 방화벽을 이용해야하고 4242포트만 열어놔야한다.
- 방화벽은 가상머신을 시작할때 작동해야한다. centOS에서 기본방화벽 대신에 UFW방화벽을 이용해야 한다. 설치하기 위해서는 DNF가 필요할듯
- 강한 암호 폴리시를 구현해야합니다.
- root 유저 외에도 `[당신의 로그인]`이 유저네임인 유저가 존재해야 합니다.
- 평가 중에 새 유저를 생성해서 그룹에 할당해야 합니다.

- 강한 암호를 셋업하기 위해, 다음 요구 사항을 준수해야 합니다.

```c
1. password 는 30일마다 만료되어야한다.
2. 비밀번호 최소 사용일이 2일 이다 (비밀번호 변경후 2일이 지나야 다시변경 가능)
3. 유저는 비밀번호 만료 7일전에 경고 메세지를 받아야 한다.
4. 비밀번호는 최소 10자리여야 한다. 영어 대문자 + 숫자는 꼭 포함하고 있어야 한다. 3개 이상의 연속된 동일한 문자를 가지면 안된다.
5. 비밀번호는 사용자의 이름을 포함하면 안된다.
6. 비밀번호는 이전의 비밀번호와 다른 최소 7글자를 가져야 한다.
7. 당연히 root password는 이 정책을 따라야한다.
8. 구성 file을 셋팅한 후, 가상머신에 존재하는 모든 계정의 비밀번호를 바꿔야 한다. 루트계정 포함.
```
